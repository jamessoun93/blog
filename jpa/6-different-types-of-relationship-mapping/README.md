# [JPA #6] 다양한 연관관계 매핑

OneToMany 보다는 ManyToOne 을 사용

데이터베이스 테이블과 비슷하게 Many 쪽에서 FK를 관리하면 헷갈릴게 없음.

- 엔티티가 관리하는 FK가 실제 테이블 구조와 다르게 반대 테이블에 있고
- 연관관계 관리를 위해 추가로 UPDATE 문이 실행됨.

결국 설계가 단순해야하니 다대일을 써라.

일대일 매핑 시 trade off 고려사항

외래키를 어디에 놓을 것인가

주 테이블에 외래 키

- 주 객체가 대상 객체의 참조를 가지는 것 처럼 주 테이블에 외래 키를 두고 대상 테이블을 찾음.
- 객체지향 개발자 선호
- JPA 매핑 편리
- 장점: 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능
- 단점: 값이 없으면 외래 키에 null 허용

대상 테이블에 외래 키

- 대상 테이블에 외래 키가 존재
- 전통적인 데이터베이스 개발자 선호
- 장점: 주 테이블과 대상 테이블을 일대일에서 일대다 관계로 변경할 때 테이블 구조 유지
- 단점: 프록시 기능의 한계로 지연 로딩으로 설정해도 항상 즉시 로딩됨

다대다 사용 시 문제점 (이런 이유로 실무에서 사용 안함)

- 연결만 해주고 중간 테이블에 추가 정보를 넣을 수가 없음
- 그래서 연결 테이블용 엔티티 추가해서 @OneToMany와 @ManyToOne 으로
- 연결 테이블 PK도 웬만하면 복합키 말고 GeneratedValue 사용하는게 유연함
- PK가 어딘가에 종속되어 있는 형태로 만들어지면 유연하지가 못함
  - 예를 들어, 복합키에 추가해야하는 컬럼이 생길 경우?
- UUID 혹은 GeneratedValue 사용하는게 편하다고 생각
- 복합키 사용 vs GeneratedValue 사용 트레이드오프 생각해보기
